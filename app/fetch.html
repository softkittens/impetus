<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Impetus: fetch</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="min-h-dvh bg-white text-gray-900">
  <main class="mx-auto max-w-3xl p-6 space-y-8">
    <header class="space-y-2">
      <h1 class="text-2xl font-bold">Async Fetch + Loading</h1>
      <p class="text-sm text-gray-600">Load data with loading and error states.</p>
    </header>

    <!-- Host -->
    <div use="FetchDemo" class="max-w-2xl"></div>

    <!-- Template -->
    <template id="fetch-demo">
      <div class="space-y-4">
        <div class="flex items-center gap-2">
          <button class="rounded bg-gray-900 px-3 py-2 text-sm text-white hover:bg-gray-800"
            onclick="load()">Reload</button>
          <span class="text-sm text-gray-600">Endpoint: https://jsonplaceholder.typicode.com/users</span>
        </div>

        <!-- Loading -->
        <div class="text-sm text-gray-600" @show="loading">Loading...</div>

        <!-- Error -->
        <div class="rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700" @show="error">
          <div class="font-medium">Error</div>
          <div class="mt-1">{error}</div>
          <button class="mt-2 rounded bg-red-600 px-2 py-1 text-xs text-white hover:bg-red-700"
            onclick="load()">Retry</button>
        </div>

        <!-- List -->
        <div @show="!loading && !error && items.length" class="rounded border border-gray-200 bg-white">
          <ul class="divide-y divide-gray-100">
            <li @each="items as u,i" class="p-3">
              <div class="font-medium">{u.name}</div>
              <div class="text-sm text-gray-600">{u.email}</div>
            </li>
          </ul>
        </div>

        <!-- Empty -->
        <div @show="!loading && !error && !items.length" class="text-sm text-gray-600">No data yet.</div>
      </div>
    </template>

    <!-- Logic -->
    <script>
      class FetchDemo {
        static template = 'fetch-demo'
        constructor() {
          this.loading = false
          this.error = ''
          this.items = []
        }
        async load() {
          this.loading = true
          this.error = ''
          try {
            const res = await fetch('https://jsonplaceholder.typicode.com/users')
            if (!res.ok) throw new Error('HTTP ' + res.status)
            const data = await res.json()
            this.items = Array.isArray(data) ? data : []
          } catch (e) {
            this.error = (e && e.message) ? e.message : 'Request failed'
          } finally {
            this.loading = false
          }
        }
        onMount() {
          this.load()
        }
      }
    </script>

    <script type="module">
      import { init } from './impetus.js'
      init()
    </script>
  </main>
</body>

</html>
